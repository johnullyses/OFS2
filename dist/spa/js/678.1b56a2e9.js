"use strict";(globalThis["webpackChunkofs_2_0"]=globalThis["webpackChunkofs_2_0"]||[]).push([[678],{8678:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var l=a(3673);const r={style:{"max-height":"90vh",overflow:"auto"}},o=(0,l.uE)('<div class="q-pa-md row" style="margin-left:15px;margin-right:15px;padding-left:0px;border-bottom:2px solid #DEDEDE;"><div class="col-6"><div style="font-size:20px;"><b>Cancelled Orders</b></div></div><div class="col-6"><div style="font-size:15px;text-align:right;"><b>Date: </b> Today</div></div></div><div style="margin-left:15px;margin-top:15px;font-size:15px;"><b>Filters:</b></div>',2),n={class:"row items-start q-pa-md"},s={class:"col-xs-12 col-sm-6 col-md-2 gutter"},i={class:"col-xs-12 col-sm-6 col-md-2 gutter"},c={class:"col-xs-12 col-sm-6 col-md-2 gutter"},d={class:"col-xs-12 col-sm-6 col-md-2 gutter"},m={class:"col-xs-12 col-sm-6 col-md-2 gutter"},u={class:"gutter"},p={class:"q-pa-md"},_=(0,l._)("div",{class:"text-h6"},"Alert",-1);function h(e,t,a,h,g,y){const b=(0,l.up)("q-select"),v=(0,l.up)("q-input"),f=(0,l.up)("q-btn"),x=(0,l.up)("q-table"),D=(0,l.up)("q-card-section"),w=(0,l.up)("q-card-actions"),C=(0,l.up)("q-card"),O=(0,l.up)("q-dialog"),S=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.iD)("div",r,[o,(0,l._)("div",n,[(0,l._)("div",s,[(0,l.Wm)(b,{"bg-color":"white",outlined:"",options:e.sourcesOption,modelValue:e.source,"onUpdate:modelValue":t[0]||(t[0]=t=>e.source=t),"option-value":"id","option-label":"source_name",hint:"Source",label:"All order sources",dense:"",style:{"margin-right":"8px"}},null,8,["options","modelValue"])]),(0,l._)("div",i,[(0,l.Wm)(b,{"bg-color":"white",outlined:"",options:e.paymentOption,modelValue:e.payment,"onUpdate:modelValue":t[1]||(t[1]=t=>e.payment=t),"option-value":"id","option-label":"payment_type",hint:"Payment",label:"All order sources",dense:"",style:{"margin-right":"8px"}},null,8,["options","modelValue"])]),(0,l._)("div",c,[(0,l.Wm)(b,{"bg-color":"white",outlined:"",options:e.methodOption,modelValue:e.method,"onUpdate:modelValue":t[2]||(t[2]=t=>e.method=t),"option-value":"id","option-label":"name",hint:"Method",label:"All order sources",dense:"",style:{"margin-right":"8px"}},null,8,["options","modelValue"])]),(0,l._)("div",d,[(0,l.Wm)(v,{style:{"margin-right":"8px"},"bg-color":"white",outlined:"",type:"date",hint:"Start date *",modelValue:e.startDate,"onUpdate:modelValue":t[3]||(t[3]=t=>e.startDate=t),dense:""},null,8,["modelValue"])]),(0,l._)("div",m,[(0,l.Wm)(v,{style:{"margin-right":"8px"},"bg-color":"white",outlined:"",type:"date",hint:"End date *",min:e.minDate,max:e.maxDate,modelValue:e.endDate,"onUpdate:modelValue":t[4]||(t[4]=t=>e.endDate=t),dense:""},null,8,["min","max","modelValue"])]),(0,l._)("div",u,[(0,l.Wm)(f,{color:"primary","icon-right":"search",label:"Search","no-caps":"",onClick:e.searchFilter,style:{"margin-right":"8px"}},null,8,["onClick"]),(0,l.Wm)(f,{color:"primary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:e.exportFiltered,style:{"margin-right":"8px"}},null,8,["onClick"])])]),(0,l._)("div",null,[(0,l._)("div",p,[(0,l.Wm)(x,{id:"test",pagination:e.initialPagination,color:"primary",columns:e.columns,rows:e.rows,"row-key":"name",ref:"tb",loading:e.loading},null,8,["pagination","columns","rows","loading"])])]),(0,l.Wm)(O,{modelValue:e.dialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.dialog=t),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{class:"bg-red text-white",style:{width:"300px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(D,null,{default:(0,l.w5)((()=>[_])),_:1}),(0,l.Wm)(D,{class:"q-pt-none"},{default:(0,l.w5)((()=>[(0,l.Uk)(" Start date and End date are required. ")])),_:1}),(0,l.Wm)(w,{align:"right",class:"bg-white text-black"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(f,{flat:"",label:"OK"},null,512),[[S]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}a(5363),a(5663);var g=a(741),y=a(2841);function b(e,t){let a=void 0!==t?t(e):e;return a=void 0===a||null===a?"":String(a),a=a.split('"').join('""'),`"${a}"`}const v=(0,l.aZ)({name:"CancelledOrders",async beforeMount(){await this.allSources()},computed:{...(0,g.Se)("CancelledOrder",{orderCancelled:"GET_ORDER_CANCELLED",sources:"GET_SOURCES",loading:"GET_LOADING"}),...(0,g.Se)("Auth",{user:"GET_PROFILE"}),sourcesOption(){var e=this.sources,t=[{id:0,source_name:"All"}],a=t.concat(e.sources);return a},paymentOption(){var e=this.sources,t=[{id:0,payment_type:"All"}],a=t.concat(e.payment);return a},methodOption(){var e=this.sources,t=[{id:0,name:"All"}],a=t.concat(e.method);return a}},data(){return{initialPagination:{sortBy:"desc",descending:!0,rowsPerPage:50},columns:[{name:"order_number",label:"Order No",field:"order_number",align:"center"},{name:"order_source",label:"Order Source",field:"order_source",align:"center"},{name:"payment",label:"Payment",field:"payment",align:"center"},{name:"service_method",label:"Service Method",field:"service_method",align:"center"},{name:"customer_name",label:"Customer Name",field:"customer_name",align:"center"},{name:"phone",label:"Phone",field:"phone",align:"center"},{name:"order_time",label:"Order Time",field:"order_time",align:"center"},{name:"net_price",label:"NetPrice(Exc.DC)",field:"net_price",align:"center"},{name:"gross_price",label:"GrossPrice(Inc.DC)",field:"gross_price",align:"center"},{name:"reason",label:"Reason",field:"reason",field:"reason",align:"center"},{name:"primary_issue",label:"Primary Issue",field:"primary_issue",align:"center"},{name:"cancellation_reason",label:"Cancellation Reason",field:"cancellation_reason",align:"center"},{name:"cancelled_by",label:"Cancelled By",field:"cancelled_by",align:"center"},{name:"cancelled_date",label:"Cancelled Date",field:"cancelled_date",align:"center"}],rows:[],total_net:"",total_gross:"",searchText:"",startDate:"",endDate:"",source:{source_name:"All"},payment:{payment_type:"All"},method:{name:"All"},dialog:!1,position:"top",minDate:"",maxDate:""}},methods:{...(0,g.nv)("CancelledOrder",["cancelledOrder","allSources"]),async cancelledOrderTable(){var e=this.orderCancelled,t=[];e.forEach((e=>{this.total_net+=parseFloat(e.total_w_vat);var a={order_number:e.order_pin,order_source:e.order_source,payment:e.payment_text,service_method:e.service_method_text.replace(/(?:^|\s)\S/g,(function(e){return e.toUpperCase()})),customer_name:e.customer.first_name+" "+e.customer.last_name,phone:e.customer.home_phone_1,order_time:e.order_date,net_price:e.total_w_vat,gross_price:e.total_gross,reason:"",primary_issue:e.reason_primary,cancellation_reason:e.reason_secondary,cancelled_by:e.canceled_by_name,cancelled_date:e.canceled_datetime};t.push(a)})),this.rows=t},exportFiltered(){var e=new Date;e.setDate(e.getDate());var t=e.toISOString().slice(0,10),a=this.user,l=a.store_name+"/CancelledOrders/"+t;const r=[this.columns.map((e=>b(e.label)))].concat(this.$refs.tb.filteredSortedRows.map((e=>this.columns.map((t=>b("function"===typeof t.field?t.field(e):e[void 0===t.field?t.name:t.field],t.format))).join(",")))).join("\r\n");(0,y.Z)(l+".csv",r,"text/csv")},searchFilter(){const e=new Date;e.getHours(),e.getMinutes(),e.getSeconds();""==this.startDate||""==this.endDate?(this.dialog=!0,this.rows=[]):this.cancelledOrder({startDate:this.startDate,endDate:this.endDate,source:this.source,payment:this.payment,method:this.method}).then((()=>{var e=this.orderCancelled,t=[];e.forEach((e=>{var a={order_number:e.order_pin,order_source:e.order_source,payment:e.payment_text,service_method:e.service_method_text.replace(/(?:^|\s)\S/g,(function(e){return e.toUpperCase()})),customer_name:e.customer.first_name+" "+e.customer.last_name,phone:e.customer.home_phone_1,order_time:e.order_date,net_price:e.total_w_vat,gross_price:e.total_gross,reason:"",primary_issue:e.reason_primary,cancellation_reason:e.reason_secondary,cancelled_by:e.canceled_by_name,cancelled_date:e.canceled_datetime};t.push(a)}));var a=0,l=0;t.forEach((e=>{a+=parseFloat(e.net_price),l+=parseFloat(e.gross_price)})),this.total_net=a,this.total_gross=l;var r=[{order_number:"TC: "+t.length,order_source:"",payment:"",service_method:"",customer_name:"",phone:"",order_time:"",net_price:this.total_net,gross_price:this.total_gross,reason:"",primary_issue:"",cancellation_reason:"",cancelled_by:"",cancelled_date:""}],o=t.concat(r);this.rows=o}))}},watch:{startDate(){if(""==this.startDate)this.minDate="",this.maxDate="";else{this.minDate=this.startDate;var e=new Date(this.startDate);e.setDate(e.getDate()+31),this.maxDate=e.toISOString().slice(0,10)}}}});var f=a(4260),x=a(4842),D=a(4554),w=a(2448),C=a(8240),O=a(8107),S=a(6778),E=a(151),V=a(5589),A=a(9367),W=a(677),q=a(7518),Z=a.n(q);const P=(0,f.Z)(v,[["render",h]]),T=P;Z()(v,"components",{QInput:x.Z,QIcon:D.Z,QSelect:w.Z,QBtn:C.Z,QTable:O.Z,QDialog:S.Z,QCard:E.Z,QCardSection:V.Z,QCardActions:A.Z}),Z()(v,"directives",{ClosePopup:W.Z})}}]);